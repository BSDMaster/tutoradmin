<!DOCTYPE html>
<html>

<head>

</head>

<body>
    <div id="breadcrumbBlacklistTutor">
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                <a href="javascript:loadMainPage();">หน้าหลัก</a>
            </li>
            <li class="breadcrumb-item">
                <a href="javascript:changePage('./html/tutorblacklist.html');">ติวเตอร์ Blackilist</a>
            </li>
            <li class="breadcrumb-item active">ข้อมูลติวเตอร์</li>
        </ol>
    </div>
    <div id="breadcrumbReportTutor">
            <ol class="breadcrumb">
                <li class="breadcrumb-item">
                    <a href="javascript:loadMainPage();">หน้าหลัก</a>
                </li>
                <li class="breadcrumb-item">
                    <a href="javascript:changePage('./html/reporttutorlist.html');">รายงานรายการติวเตอร์และวิชาสอน</a>
                </li>
                <li class="breadcrumb-item active">ข้อมูลติวเตอร์</li>
            </ol>
        </div>
    <br>
    <div class="alert alert-dismissible alert-success" style="display: none;">
        <button type="button" class="close" data-dismiss="alert">&times;</button>
        <strong>บันทึกข้อมูลสำเร็จ</strong>
    </div>
    <div class="alert alert-dismissible alert-danger" style="display: none;">
        <button type="button" class="close" data-dismiss="alert">&times;</button>
        <strong>ไม่สามารถบันทึกข้อมูลได้</strong>
    </div>

    <div class="container-fluid">
        <div class="row">
            <div class="label-header" id="divHeaderTutorDetail">ข้อมูลติวเตอร์รหัส </div>
            <div id="divRejectFlag" class="fa-reject-o" style="margin-top:10px;margin-left:5px;margin-right:5px;"></div>
            <div id="divNonVerifiedFlag" class="fa-nonverified-o" style="margin-top:10px;margin-left:5px;margin-right:5px;"></div>
            <div id="divVerifiedFlag" class="fa-verified-o" style="margin-top:10px;margin-left:5px;margin-right:5px;"></div>
            <div id="divLockFlag" class="fa-lock-o" style="margin-top:10px;margin-left:5px;margin-right:5px;"></div>
        </div>
    </div>
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-12 ">
                <button type="button" class="btn btn-danger btn-lg pull-right" id="btnRejectTutorDetail" onClick="javascript:rejectTutorDetailConfirmPopup();"
                    style="margin:5px;">ไม่อนุมัติผลการตรวจสอบประวัติ</button>
                <button type="button" class="btn btn-success btn-lg pull-right" id="btnApproveTutorDetail" onClick="javascript:approveTutorDetailConfirmPopup();"
                    style="margin:5px;">อนุมัติผลการตรวจสอบประวัติ</button>
                <button type="button" class="btn btn-primary btn-lg pull-right" id="btnUnlockTutorDetail" onClick="javascript:unlockTutorDetailConfirmPopup();"
                    style="margin:5px;">ปลดล็อค</button>
            </div>
        </div>
    </div>
    <br>
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-12">
                <form class="form-horizontal">
                    <div class="form-group required">
                        <label class="col-lg-2 labelform">ชื่อ</label>
                        <div id="txtFirstName" class="col-lg-4">
                        </div>
                        <div class="col-lg-6"></div>
                    </div>
                    <div class="form-group required">
                        <label class="col-lg-2 labelform">นามสกุล</label>
                        <div id="txtLastName" class="col-lg-4">
                        </div>
                        <div class="col-lg-6"></div>
                    </div>
                    <div class="form-group">
                        <label class="col-lg-2">ชื่อเล่น</label>
                        <div id="txtNickname" class="col-lg-4">
                        </div>
                        <div class="col-lg-6"></div>
                    </div>
                    <div class="form-group required">
                        <label class="col-lg-2 labelform">อีเมล์</label>
                        <div id="txtEmail" class="col-lg-4">
                        </div>
                        <div class="col-lg-6"></div>
                    </div>
                    <div class="form-group required">
                        <label class="col-lg-2 labelform">เบอร์โทรมือถือ</label>
                        <div id="txtTel" class="col-lg-4">
                        </div>
                        <div class="col-lg-6"></div>
                    </div>
                    <div class="form-group required">
                        <label class="col-lg-2 labelform">เพศ</label>
                        <div id="dropdownSex" class="col-lg-4">
                        </div>
                        <div class="col-lg-6"></div>
                    </div>
                    <div class="form-group required">
                        <label class="col-lg-2 labelform">สถาบันศึกษา</label>
                        <div id="dropdownUniversity" class="col-lg-4">
                        </div>
                        <div class="col-lg-6"></div>
                    </div>
                    <div class="form-group required">
                        <label class="col-lg-2 labelform">คณะ</label>
                        <div id="dropdownFaculty" class="col-lg-4">
                        </div>
                        <div class="col-lg-6"></div>
                    </div>
                    <div class="form-group required">
                        <label class="col-lg-2 labelform">วัน เดือน ปีเกิด</label>
                        <div id="pickerBirthdate" class="col-lg-4">
                        </div>
                        <div class="col-lg-6"></div>
                    </div>
                    <div class="form-group required">
                        <label class="col-lg-2 labelform">เอกสารสำเนาบัตรประชาชน</label>
                        <div id="" class="col-lg-4">
                            <button class="btn btn-xs btn-default" type='button'>
                                <div class='fa-download-o'></div>
                            </button>
                        </div>
                        <div class="col-lg-6"></div>
                    </div>
                    <div class="form-group">
                        <label class="col-lg-2 ">ที่อยู่ปัจจุบัน</label>
                        <div id="txtAddress" class="col-lg-4">
                        </div>
                        <div class="col-lg-6"></div>
                    </div>
                    <div class="form-group">
                        <label for="player" class="col-lg-2">คลิปตัวอย่างงานสอน</label>
                        <div class="col-lg-5" id="player">
                        </div>
                        <div class="col-lg-5">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-lg-2">ข้อมูลงานสอนเพิ่มเติม</label>
                        <div id="txtOthers" class="col-lg-4">
                        </div>
                        <div class="col-lg-6"></div>
                    </div>
                    <div class="form-group">
                            <label class="col-lg-2">ผลการประเมิน</label>
                            <div id="lblEvaScore" class="col-lg-4">
                            </div>
                            <div class="col-lg-6"></div>
                        </div>
                    <br>
                </form>
            </div>
        </div>
    </div>
    <div class="label-header">ข้อมูลวิชาสอน</div>
    <table id="gridTutorSubject" class="table table-condensed table-hover table-striped scroll">
            <thead>
                <tr>
                    <th data-column-id="id" data-width="10%" data-identifier="true" data-type="numeric">#</th>
                    <th data-column-id="class" data-width="40%">วิชา</th>
                    <th data-column-id="level" data-width="30%">ระดับชั้น</th>
                    <th data-column-id="exp" data-width="20%">ประสบการณ์สอน</th>
                </tr>
            </thead>
        </table>
    <div class="label-header">ข้อมูลวัน เวลา และสถานที่</div>
    <table id="gridJobDetail" class="table table-condensed table-hover table-striped scroll">
            <thead>
                <tr>
                    <th data-column-id="id" data-width="3%" data-identifier="true" data-type="numeric">#</th>
                    <th data-column-id="day" data-width="9%">วัน</th>
                    <th data-column-id="time" data-width="12%">เวลาว่าง</th>
                    <th data-column-id="startPlace" data-width="20%">สถานที่เริ่มต้นเดินทาง</th>
                    <th data-column-id="endPlace" data-width="20%">สถานที่สิ้นสุดเดินทาง</th>
                    <th data-column-id="car" data-width="9%" data-sortable="false">รถยนต์ส่วนตัว</th>
                    <th data-column-id="bus" data-width="9%" data-sortable="false">รถประจำทาง</th>
                    <th data-column-id="bts" data-width="9%" data-sortable="false">รถไฟฟ้า</th>
                    <th data-column-id="taxi" data-width="9%" data-sortable="false">รถแท็กซี่</th>
                </tr>
            </thead>
        </table>
    </div>
    <br>
    <!-- Approve Tutor Modal -->
    <div class="modal fade" id="modalConfirmApproveTutorDetail" tabindex="-1" role="dialog" aria-labelledby="confirmApproveTutorDetailLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="confirmApproveTutorDetailLabel">ยืนยันอนุมัติติวเตอร์</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" id="divConfirmApproveDetailMsg">
                    ท่านต้องการยืนยันการอนุมัติผลการตรวจสอบติวเตอร์
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-default btn-lg" data-dismiss="modal">ยกเลิก</button>
                    <button type="button" class="btn btn-primary btn-lg" onclick="javascript:approveverifytutorDetail()">อนุมัติ</button>
                </div>
            </div>
        </div>
    </div>
    <br>
    <!-- Reject Tutor Modal -->
    <div class="modal fade" id="modalConfirmRejectTutorDetail" tabindex="-1" role="dialog" aria-labelledby="confirmRejectTutorDetailLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="confirmRejectTutorDetailLabel">ยืนยันไม่อนุมัติติวเตอร์</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" id="divConfirmRejectDetailMsg">
                    ติวเตอร์นี้ไม่ผ่านการตรวจสอบประวัติและคุณสมบัติ ท่านต้องการปฏิเสธคำขอสมัครสมาชิก
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-default btn-lg" data-dismiss="modal">ยกเลิก</button>
                    <button type="button" class="btn btn-primary btn-lg" onclick="javascript:rejecttutorDetail()">ไม่อนุมัติ</button>
                </div>
            </div>
        </div>
    </div>
    <br>
    <!-- Modal Unlock -->
    <div class="modal fade" id="modalConfirmUnlockTutorDetail" tabindex="-1" role="dialog" aria-labelledby="modalConfirmUnlockTutorDetailLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalConfirmUnlockTutorDetailLabel">ยืนยัน</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" id="divConfirmUnlockDetailMsg">
                        ท่านต้องการ unlock
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary btn-lg" data-dismiss="modal">ยกเลิก</button>
                    <button type="button" class="btn btn-primary btn-lg" onclick="javascript:unlockTutorDetail()" value="">อนุมติ</button>
                </div>
            </div>
        </div>
    </div>

</body>
<script>

    jQuery(document).ready(function () {
        initialTutorProfile();
        initialSubjectAndTimes();
        if (_gTutorDetailFrom=="B") {
            $("#breadcrumbBlacklistTutor").show();
            $("#breadcrumbReportTutor").hide();
        } else if (_gTutorDetailFrom=="R") {
            $("#breadcrumbBlacklistTutor").hide();
            $("#breadcrumbReportTutor").show();
        }
    });


    function initialTutorProfile() {
        console.log(_gSelectedTurId);
        $.ajax({
            type: "GET",
            url: _gServiceURL + "tutor/getprofile/" + _gSelectedTurId,
            contentType: "application/json; charset=utf-8",
            crossDomain: true,
            dataType: "json",
            success: function (data, status, jqXHR) {
                var tutor = data.data.tutorProfileView;
                console.log(tutor);
                $('#divHeaderTutorDetail').text('ข้อมูลติวเตอร์รหัส ' + tutor.turId);
                $('#lblEvaScore').text(tutor.turEvaScore);
                $('#txtFirstName').text(tutor.turFirstname);
                $('#txtLastName').text(tutor.turLastname);
                $('#txtNickname').text(tutor.turNickname);
                $('#txtTel').text(tutor.turTel);
                $('#txtAddress').text(tutor.turAddress);
                $('#txtEmail').text(tutor.turEmail);
                // $('#pickerBirthdate').val();
                $('#dropdownSex').text(tutor.turSex);
                $('#dropdownUniversity').text(tutor.university.uniName);
                $('#dropdownFaculty').text(tutor.faculty.facName);
                
                if (tutor.verifyFlag == 'Y') {
                    $('#divRejectFlag').hide();
                    $('#divNonVerifiedFlag').hide();
                    $('#divVerifiedFlag').show();
                    $('#btnApproveTutorDetail').hide();
                    $('#btnRejectTutorDetail').hide();
                } else if (tutor.verifyFlag == 'N') {
                    $('#divRejectFlag').hide();
                    $('#divNonVerifiedFlag').show();
                    $('#divVerifiedFlag').hide();
                    $('#btnApproveTutorDetail').show();
                    $('#btnRejectTutorDetail').show();
                } else {
                    $('#divRejectFlag').show();
                    $('#divNonVerifiedFlag').hide();
                    $('#divVerifiedFlag').hide();
                    $('#btnApproveTutorDetail').hide();
                    $('#btnRejectTutorDetail').hide();
                }
                if (tutor.isBlock == 'Y') {
                    $('#btnUnlockTutorDetail').show();
                    $('#divLockFlag').show();
                } else {
                    $('#btnUnlockTutorDetail').hide();
                    $('#divLockFlag').hide();
                }
                
/*
                tag.src = "https://www.youtube.com/iframe_api";
                var firstScriptTag = document.getElementsByTagName('script')[0];
                firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);*/
                
                if (tutor.turClip!=null) {
                    console.log('tutor.turClip',tutor.turClip);
                    var videoId = getYoutubeVideoID(tutor.turClip);
                    onYouTubeIframeAPIReady(videoId);
                }

            },
            error: function (jqXHR, status) {
            }

        });
    }

    function initialSubjectAndTimes() {
            console.log('initial data');
            $.ajax({
                type: "GET",
                url: _gServiceURL + "tutor/getworkdetail/" + _gSelectedTurId,
                contentType: "application/json; charset=utf-8",
                crossDomain: true,
                dataType: "json",
                success: function (data, status, jqXHR) {
                    var tutorView = data.data.tutorView;
                    console.log(tutorView);
                    var messages = data.message;
                    var alert;
                    if (tutorView != null) {
                        /*
                        if (tutorView.englishFlag == 'Y') {
                            $('#chkEnglishFlag').prop('checked', true);
                        }
                        if (tutorView.interFlag == 'Y') {
                            $('#chkInterFlag').prop('checked', true);
                        }*/
                        console.log('tutorView.maxClsPerDay');
                        console.log(tutorView.maxClsPerDay);
                        $('#optMaxWorkPerDay').val(tutorView.maxClsPerDay);
                        $('#optMaxWork').val(tutorView.maxCls);
                        var applySubjects = tutorView.subjectDetailViews;
                        var applyDays = tutorView.tutorAvailableTimeloacations;
                        for (var i = 0; i < applySubjects.length; i++) {
                            console.log("data : " + applySubjects[i]);
                            appendApplySubjectList(applySubjects[i], i);
                        }
                        for (var j = 0; j < applyDays.length; j++) {
                            console.log("data : " + applyDays[j]);
                            appendApplyDayList(applyDays[j], j);
                        }
                    }

                },
                error: function (jqXHR, status) {
                    console.log(jqXHR);
                    alert('fail' + status.code);
                }
            });
        }


    var player;
    function onYouTubeIframeAPIReady(videoId) {
        player = new YT.Player('player', {
            height: '300',
            width: '300',
            videoId: videoId
        });
    }


    function getYoutubeVideoID(url) {
        var regExp = /^.*(youtu\.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;
        var match = url.match(regExp);
        if (match && match[2].length == 11) {
            return match[2];
        } else {
            return "";
        }
    }

    function approveTutorDetailConfirmPopup() {
        $('#divConfirmApproveDetailMsg').text('กรุณากดปุ่มยืนยันหากท่านต้องการยืนยันการอนุมัติผลการตรวจสอบติวเตอร์รหัส '+_gSelectedTurId);
        $('#modalConfirmApproveTutorDetail').modal('show');
    }
    function approveverifytutorDetail() {
        $('#modalConfirmApproveTutorDetail').modal('hide');
        $.ajax({
            type: "GET",
            url: _gServiceURL + "tutor/approve/" + _gSelectedTurId,
            contentType: "application/json; charset=utf-8",
            crossDomain: true,
            dataType: "json",
            success: function (data, status, jqXHR) {
                var messages = data.message;
                var alert;
                if (data.status == 200) {
                    alert = $(".alert-success");
                    initialTutorProfile();
                } else {
                    alert = $(".alert-danger");
                }
                alert.find("strong").text(messages);
                alert.show();
                $('html, body').animate({ scrollTop: $('.breadcrumb').offset().top }, 'fast');
            },
            error: function (jqXHR, status) {
                $(".alert-danger").show();
                $('html, body').animate({ scrollTop: $('.breadcrumb').offset().top }, 'fast');
            }
        });
    }
    function rejectTutorDetailConfirmPopup() {
        $('#divConfirmRejectDetailMsg').text('กรุณากดปุ่มยืนยันหากท่านต้องการยืนยันว่าติวเตอร์รหัส '+_gSelectedTurId+'  ไม่ผ่านการตรวจสอบประวัติและคุณสมบัติ ท่านต้องการปฏิเสธคำขอสมัครสมาชิก');
        $('#modalConfirmRejectTutorDetail').modal('show');
    }
    function rejecttutorDetail() {
        $('#modalConfirmRejectTutorDetail').modal('hide');
        $.ajax({
            type: "GET",
            url: _gServiceURL + "tutor/reject/" + _gSelectedTurId,
            contentType: "application/json; charset=utf-8",
            crossDomain: true,
            dataType: "json",
            success: function (data, status, jqXHR) {
                var messages = data.message;
                var alert;
                if (data.status == 200) {
                    alert = $(".alert-success");
                    initialTutorProfile();
                } else {
                    alert = $(".alert-danger");
                }
                alert.find("strong").text(messages);
                alert.show();
                $('html, body').animate({ scrollTop: $('.breadcrumb').offset().top }, 'fast');
            },
            error: function (jqXHR, status) {
                $(".alert-danger").show();
                $('html, body').animate({ scrollTop: $('.breadcrumb').offset().top }, 'fast');
            }
        });
    }
    // Unlock 
    function unlockTutorDetailConfirmPopup() {
        $('#divConfirmUnlockDetailMsg').text('กรุณากดปุ่มยืนยันหากท่านต้องการปลดล็อคติวเตอร์รหัส ' + _gSelectedTurId);
        $('#modalConfirmUnlockTutorDetail').modal('show');
    }

    function unlockTutorDetail(){

        $('#modalConfirmUnlockTutorDetail').modal('hide');
        $.ajax({
            type: "GET",
            url: _gServiceURL + "tutor/unlockblacklist/" + _gSelectedTurId,
            contentType: "application/json; charset=utf-8",
            crossDomain: true,
            dataType: "json",
            success: function (data, status, jqXHR) {
                var messages = data.message;
                var alert;
                if (data.status == 200) {
                    alert = $(".alert-success");
                    initialTutorProfile();
                } else {
                    alert = $(".alert-danger");
                }
                alert.find("strong").text(messages);
                alert.show();
                $('html, body').animate({ scrollTop: $('.breadcrumb').offset().top }, 'fast');
            },
            error: function (jqXHR, status) {
                $(".alert-danger").show();
                $('html, body').animate({ scrollTop: $('.breadcrumb').offset().top }, 'fast');
            }
        });
    }

        var gridJobDetail = $("#gridJobDetail").bootgrid({
            navigation: 0,
            labels: {
                noResults: 'ไม่พบรายการ'
            }
        });

        var gridTutorSubject = $("#gridTutorSubject").bootgrid({
            navigation: 0,
            labels: {
                noResults: 'ไม่พบรายการ'
            }
        });
        function appendApplySubjectList(applySubject, i) {
            console.log(applySubject);
            var exps = dataExp.filter(function (el) {
                return el.val == applySubject.exp;
            });
            var exp = 0;
            if (exps[0]) {
                exp = exps[0];
            }
            gridTutorSubject.bootgrid("append", [
                {
                    "id": i+1,
                    "class": applySubject.subject.subjName,
                    "level": applySubject.subjectCatagory.subcName,
                    "exp": exp.name
                    }
            ]);
        }
        function appendApplyDayList(applyDay, i) {
            console.log(applyDay);
            var dayId = applyDay.tavDayId;
            var divSignActive = "<div class='signActive'></div>";
            var divSignInactive = "<div class='signInActive'></div>";
            var chkCar;
            var chkBus;
            var chkBTS;
            var chkTaxi;
            if (applyDay.tavTraDrive == 'Y') {
                chkCar = divSignActive;
            } else {
                chkCar = divSignInactive;
            }
            if (applyDay.tavTraBus == 'Y') {
                chkBus = divSignActive;
            } else {
                chkBus = divSignInactive;
            }
            if (applyDay.tavTraTrain == 'Y') {
                chkBTS = divSignActive;
            } else {
                chkBTS = divSignInactive;
            }
            if (applyDay.tavTraTaxi == 'Y') {
                chkTaxi = divSignActive;
            } else {
                chkTaxi = divSignInactive;
            }
            var startTimes = dataTime.filter(function (el) {
                return el.val == applyDay.tavStartTime;
            });
            var startTime = "";
            if (startTimes[0]) {
                startTime = startTimes[0];
            }
            var endTimes = dataTime.filter(function (el) {
                return el.val == applyDay.tavEndTime;
            });
            var endTime = "";
            if (endTimes[0]) {
                endTime = endTimes[0];
            }
            gridJobDetail.bootgrid("append", [
                {
                    "id": i+1,
                    "day": dataDay[applyDay.tavDayId - 1].name,
                    "time": startTime.name+ " - " + endTime.name,
                    "startPlace": applyDay.tavStartLocation,
                    "endPlace": applyDay.tavEndLocation,
                    "car": chkCar,
                    "bus": chkBus,
                    "bts": chkBTS,
                    "taxi": chkTaxi
                }
            ]);
        }
</script>

</html>